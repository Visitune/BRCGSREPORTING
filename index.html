<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Assistant Rapport BRCGS</title>
    <link rel="stylesheet" href="style.css">
    <!-- Inclusion des biblioth√®ques JS n√©cessaires -->
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/diff2html/bundles/css/diff2html.min.css" />
</head>
<body>
    <!-- Input fichiers cach√©s -->
    <input type="file" id="docx-input" accept=".docx" style="display:none;">
    <input type="file" id="json-input" accept=".json" style="display:none;">

    <!-- Barre de menu -->
    <header class="menu-bar">
        <div class="logo">
            <span role="img" aria-label="shield">üõ°Ô∏è</span> BRCGS Assistant
        </div>
        <div class="menu-group">
            <button id="load-docx-btn" title="Charger un rapport depuis un fichier .docx">Charger DOCX</button>
            <button id="load-json-btn" title="Charger un rapport en cours depuis un fichier .json">Charger JSON</button>
        </div>
        <div class="menu-group">
            <button id="save-json-btn" disabled title="Sauvegarder le rapport actuel au format .json">Sauvegarder JSON</button>
            <button id="toggle-comments-btn" disabled>Afficher Commentaires</button>
        </div>
        <div class="menu-group api-group">
            <input type="password" id="api-key-input" placeholder="Cl√© API Groq">
            <button id="set-api-key-btn">D√©finir</button>
        </div>
        <div class="status-container">
            <span class="status" id="status">Pr√™t.</span>
        </div>
    </header>

    <!-- Indicateur de chargement -->
    <div id="loading-indicator">
        <div class="spinner"></div>
        <span id="loading-message">Traitement...</span>
    </div>

    <!-- Conteneur principal -->
    <div class="main-container">
        <!-- Menu lat√©ral des chapitres principaux -->
        <aside class="sidebar">
            <h3>Chapitres Principaux</h3>
            <ul id="sidebar-nav"></ul>
        </aside>

        <!-- Zone de contenu -->
        <main class="content-area">
             <div id="welcome-screen">
                <h1>Bienvenue dans l'Assistant de Rapport BRCGS</h1>
                <p>Le moyen le plus simple de mettre √† jour vos rapports d'audit d'une ann√©e sur l'autre.</p>
                <div class="instructions">
                    <div class="step">
                        <h2>1. Chargez le rapport de l'ann√©e derni√®re</h2>
                        <p>Cliquez sur <strong>Charger DOCX</strong> pour importer le rapport de l'ann√©e pr√©c√©dente, ou <strong>Charger JSON</strong> pour continuer √† travailler sur un fichier d√©j√† √©dit√©.</p>
                    </div>
                    <div class="step">
                        <h2>2. Mettez √† jour et am√©liorez</h2>
                        <p>Modifiez directement le texte. Le syst√®me suivra vos changements. Utilisez les ic√¥nes pour obtenir de l'aide :<br>
                           <span class="icon-key">üí°</span> pour comparer avec le mod√®le BRCGS officiel.<br>
                           <span class="icon-key">ü§ñ</span> pour recevoir une suggestion de r√©√©criture par l'IA.</p>
                    </div>
                    <div class="step">
                        <h2>3. Sauvegardez votre nouveau rapport</h2>
                        <p>Cliquez sur <strong>Sauvegarder JSON</strong> pour enregistrer votre rapport mis √† jour. Vous pourrez y revenir √† tout moment.</p>
                    </div>
                </div>
            </div>
            <div id="report-output" style="display: none;">
                <div id="document-info">
                    <div id="info-content"></div>
                    <div class="legend">
                        <strong>L√©gende :</strong>
                        <span class="legend-item legend-user">Vos modifications</span>
                        <span class="legend-item legend-ai">Modifications par l'IA</span>
                    </div>
                </div>
                <div id="document-structure"></div>
            </div>
        </main>
    </div>

    <!-- Popup IA -->
    <div id="ai-modal" class="modal">
        <div class="modal-content">
            <span class="close-button" id="ai-modal-close">&times;</span>
            <h3>ü§ñ Suggestion d'Am√©lioration IA</h3>
            <p>L'IA a r√©√©crit votre texte. Les ajouts sont en <span class="diff-green">vert</span> et les suppressions en <span class="diff-red">rouge</span>.</p>
            <div id="diff-output"></div>
            <div class="modal-buttons">
                <button id="accept-suggestion" class="btn-success">Appliquer la Suggestion</button>
                <button id="reject-suggestion" class="btn-secondary">Ignorer</button>
            </div>
        </div>
    </div>
    
    <!-- Popup de visualisation du mod√®le -->
    <div id="template-modal" class="modal">
        <div class="modal-content">
             <span class="close-button" id="template-modal-close">&times;</span>
            <h3>üí° Texte du Mod√®le BRCGS</h3>
            <p>Voici le texte de r√©f√©rence du mod√®le officiel pour cette section.</p>
            <div id="template-text-content" class="text-box"></div>
             <div class="modal-buttons">
                <button id="close-template-modal" class="btn-secondary">Fermer</button>
            </div>
        </div>
    </div>

    <!-- Biblioth√®ques externes -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jsdiff/5.1.0/diff.min.js"></script> <!-- **AJOUT√â POUR CORRIGER L'IA** -->
    <script src="https://cdn.jsdelivr.net/npm/diff2html/bundles/js/diff2html.min.js"></script>
    
    <!-- Script principal de l'application -->
    <script src="script.js"></script>
</body>
</html>
